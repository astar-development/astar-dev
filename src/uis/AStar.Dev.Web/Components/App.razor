<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <base href="/"/>
    <link rel="stylesheet" href="@Assets["app.css"]"/>
    <link rel="stylesheet" href="@Assets["AStar.Dev.Web.styles.css"]"/>
    <ImportMap/>
    <link rel="icon" type="image/x-icon" href="favicon.ico"/>
    <HeadOutlet @rendermode="InteractiveServer"/>
    <script src="_content/Microsoft.FluentUI.AspNetCore.Components/js/loading-theme.js" type="text/javascript"></script>
    <loading-theme storage-name="theme"></loading-theme>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
        window.highlightMarkdown = () => {
            if (window.hljs) {
                window.hljs.highlightAll();
            }
        };
    </script>
    <!-- Add marked (Markdown parser) and DOMPurify (sanitizer) -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.8/dist/purify.min.js"></script>
    <script>
        // md: markdown text
        // allowHtml: when true, bypass sanitizer (only do this if you trust the source)
        window.renderMarkdown = (md, allowHtml) => {
            const html = window.marked?.parse(md ?? "") ?? "";
            if (allowHtml) {
                return html;
            }
            // Sanitize, but allow common code/formatting tags and classes used by highlight.js
            const cfg = {
                ALLOWED_TAGS: [
                    'pre', 'code', 'span', 'p', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6',
                    'ul', 'ol', 'li', 'a', 'strong', 'em', 'table', 'thead', 'tbody',
                    'tr', 'th', 'td', 'blockquote', 'hr', 'br', 'img'
                ],
                ALLOWED_ATTR: ['href', 'title', 'alt', 'class', 'rel', 'target', 'src']
            };
            return window.DOMPurify ? window.DOMPurify.sanitize(html, cfg) : html;
        };
    </script>
</head>

<body>
<Routes @rendermode="InteractiveServer"/>
<script src="_framework/blazor.web.js"></script>
</body>

</html>
